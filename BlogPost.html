<h1> Fantasy Basketball Data Exploration </h1>
<p>Fantasy Basketball. Part statistics, part unpredictable human behaviour. It works like this: 
All the players in the NBA are put into a pool. Then, all the fantasy team owners take turns drafting the NBA players onto their fantasy team, building up the team. Then, each week, two teams go head to head, competing to see who can win more categories. of the 11 categories on offer. </p>

<p>For the last two seasons, I have watched another player lift the trophy in my Fantasy Basketball league. I have watched as my team sat on the sideline in the final week, jealous that I hadn't picked the right players in the draft, or that I had made bad trades. I recently found out that I got 11th out of the 12 teams in the draft order, and I was sick of losing. So taking after the latest trend in sports, I decided I would need to explore the statistics.</p>

<p>This presented a huge hurdle for me. I am horrible at the statistics. I find it hard to visualise the data, and easily get overwhelmed by the calculations. The closest I ever came to failing a course was first year statistics. So I knew that I needed help. Lucky for me, I had recently been playing around with Elassandra, and Kibana, which would (hopefully) make it easier for me to get the data I needed. </p>

<h2>Fantasy Basketball 101:</h2>
<p>To follow this blog, you might need to understand a little more about fantasy basketball (and maybe basketball to begin with). </p>

<h3> The Scoring System</h3>
<p>The scoring system is based on the real-life statistics NBA players score. Each week the statistics of each player go to the fantasy team which "owns” them. Say you draft James Harden, and he scores 31 points, 11 assists, and 8 rebounds. This means your fantasy team gets 31 points, 11 assists, and 8 rebounds. This happens for each game each player on your team participates in, for the whole week. You own a player either by drafting them, or trading for them. </p>	

<p>In the league I play in, there are 11 categories:
<ul>
<li>PTS (Points which the player scores)</li>
<li>REB (Rebounds the player collects)</li>
<li>AST (Assists the player makes)</li>
<li>STL (Steals the player makes)</li>
<li>BLK (Blocks the player makes)</li>
<li>TO (Turnovers - the only statistic where the goal is to have less)</li>
<li>FG% (Field Goal percentage - Total shots made / total shots attempted (free throws not included))</li>
<li>FT% (Free throw percentage - Total free throws made / total free throws attempted)</li>
<li>3P% (Three point percentage - Total 3 point shots made / total 3 point shots attempted</li>
<li>3PM (Three point shots made)</li>
<li>DD (Double doubles - scoring double digits in two of the first 5 categories)</li>
</ul>

The goal is to win 6 (or more) categories against your opponent each week. If you can achieve that, you "win the week”. </p>

<h3>The draft process:</h3>
<p>Each year, we randomly generate the draft order for the 12 teams. This dictates which order you will be drafting. Teams draft 13 players for their team. Obviously this would be unfair if the Team which got the #1 pick, also picked 13th, so we do what's called a "snake draft". That means that the player that gets the 12th pick, also gets the 13th pick, the player who gets the 11th pick also gets the 14th pick (and we count backwards from there back to 1, then back to 12, then backwards down to 1). </p>


<h3>Punting Categories</h3>
<p>This is a strategy by where you intentionally ignore certain categories. You get the same number of points if you win 11 categories each week as if you win 6, so why try and win as many as possible? Maybe you should just focus on winning 6 specific categories. This means that players which have "warts" - categories in which they are significantly worse than average - are undervalued when compared to your punting strategy. If you are punting Free Throw % and 3P%, then your strategy will value players with these particular deficiencies higher than normal. Given that I was picking later in the draft, I thought that punting categories may give me the advantage I needed. </p>

<h2>The Technical Fun</h2>

<h3>Technology Choice</h3>
<p>Given that I didn't know what I was looking for, I wanted to use something that I could use to perform some data exploration, and hopefully get more information. Kibana and the Elasticsearch API fit this perfectly. It would allow me to load in last seasons statistics, the predicted statistics for next season, and perform all kinds of queries and graphing on it. </p>

<h3>Creating the Cluster </h3>
<p>First thing I did, was starting up an Elassandra cluster at instaclustr.console.com. Given that we would only have a small dataset, and I wasn't too phased about performance, I selected the t2.micro node size. Making a note of my cluster ips, usernames, and passwords, I started the data exploration adventure.  </p>

<h3> Importing the data</h3>
<p>So first step - import all the player data we would need through the Cassandra python driver. Given that we had 12 leagues, and 13 players per, I decided to use the top 150 players in the ESPN orderings. It's a little less than the 156 players who will be drafted, but its really your top 12 players that count. </p>
<p>I got all the player stats for the last year, and the ESPN predictions for next year, and put it into the cluster. For Rookies (players which didn't play last year) I used their ESPN predictions, and their college statistics for categories I needed. Obviously this isn't perfect, but with less than 10 rookies in the top 150, I decided it wasn't worth worrying about too much. </p>
<p>Most categries we simply imput the category value, but for the percentage based categories (FT%, FG%, and 3P%) we need to "weight” the percentages, based on how much someone shoots. The idea being that someone who as  shoots a lot badly, is worse than someone who shoots very bad, but only takes 1 shot a game. To do this we multiply attempts per game * percentage. </p>

<h4>Getting it Into Elassandra</h4>
Describe process of imputing player data (Rember we do the mapping creation in elasticsearch 1st) 

<h2> Data Analytics</h2>
<h3> First Visualisaiton - Category Spread</h3>
<p>Once this data was imported into Elassandra, I wanted to do my first analysis. I wanted to find out what categories are "top heavy”. That is, are there some categories which are so hard to win, because they are influenced by a small majority of players. These would be the categories I either have to punt, or pick players to ensure I won them. To do this I wanted to do a box plot of each of the 11 statistical categories. </p>

<p>In order to do this, what we are going to do is create a separate mapping, based off the data in the player category. We create a new mapping, categories, and write in all the data in the format we need, for easy searching. </p>

<p>Then, using kibana, we can graph the percentiles of each of the categories. What we are looking for is categories where the 95th and 100th percentile is the largest size. This means the percentage of the category which is scored by the top 5% (and top 0 players%). </p>

<iframe src="https://kibana.fb8da90356c94a0bb4ebf52579e814bb.cu.dev.instaclustr.com:5602/goto/9fed51772f070a24171cbdf292f2c8f2" height="600" width="800"></iframe>

<p>Straight away we can see that DD's, BLK, TPP, TPM, AST and FGP are probably the categories most likely to be won by a few players. Either we need to win them, or punt them. The other categories, TO, STL, REB, PTS, FTP are categories we will not put heaps of effort towards winning, but hope to get value in the later rounds from them. </p>

<h3>Getting averages for each category</h3>
<p>This is where we use Elassandra to calculate the averages for each category. Using a quick query, we can get the average of each of the categories we have. Then we write this back into the Elassandra Cluster. 
This is going to be useful in the next step: my attempt at data analysis. </p>

<p>(Talk about how i calculated the averages a bit)</p>

<h3>Players Worth</h3>
<p>Calculating a players worth can be very tricky. One method for calculating a players value in real NBA analysis is the WARP statistic (https://www.nbastuffer.com/analytics101/wins-above-replacement-player-warp/). The idea is a player is worth as much as he helps his team, above the average replacement player. This idea intrigued me for fantasy. By calculating the "average player" on the top 150 players, we can get our own fantasy version of warp. </p>

<p>So, the basic idea behind my analytics is that the players value, for any given category is (player stat - average stat). </p>

<p>This is a good first step. But if we leave it as is, categories like points, where the average is in the mid 30''s, would be weighted significantly more than categories like blocks, which are in the low single digits. So we will first normalise the values. This would be:</p>
<p>normalised value = (player value - minimum player value) / (maximum player value - minimum player value). </p>

<p>If NBA players were superhumans, sorry - more superhuman then they already are, they would play the full 82 games per year. But the truth is, that players get injured, and miss games. Some players have a history of injuries and are more likely to miss more games. So, we need to weight each category with expected number of games. </p>
<p>Weight = (player expected games /82). </p>

<p>So - putting it all together, each category will be:</p>
<p>player value = Normalised(player statistic) - normalised(average statistic) * (player expected games / 82) </p>

<p>And that's it - that's all the statistical talent I have. There is almost certainly a better and more accurate statistical formula for evaluating the player value - but I don't need 100% accuracy. I need help finding large outliers, anddeciding if one player or another is of more value to me with my specific punting categories. </p>

<h3>Player Value:</h3>
<p>To calculate the overall player value, I simply summed all the weighted normalised category values. </p>


<p>This is where I started to see some VERY interesting data. First of all - lets graph the player value (top 25 players only to start with).</p>

<iframe src="https://kibana.fb8da90356c94a0bb4ebf52579e814bb.cu.dev.instaclustr.com:5602/goto/20df61489c122c5f1fa50fc517e0f902" height="600" width="800"></iframe>

<p>Now you understand why I am so unhappy with the #11 pick. At #11 Damien Lillard is "worth" nearly half of the presumptive #1 pick - James Harden. Great. I'm going to have to go through the bargain basement to win this comp. </p>

<h3>Categories with Value</h3>
<p>What I'm going to do now is plot the normalised statistical value, against the players, sorted by the ranking by player value. The idea behind this is to try and find which categories I should be punting, and which categories I should be trying to win. </p>

<iframe src="https://kibana.fb8da90356c94a0bb4ebf52579e814bb.cu.dev.instaclustr.com:5602/goto/20ec4fa8f35de3a678d3de4ac8b2a472" height="600" width="800"></iframe>

<p>The first thing I notice: How tightly coupled 3PP and 3PM are. This makes sense - good shooters generally shoot more than bad shooters. This means - realistically I either need to punt both categories, or go after both categories. Punting one of the two is a bad idea. At this stage I'mg going to punt them. </p>

<iframe src="https://kibana.fb8da90356c94a0bb4ebf52579e814bb.cu.dev.instaclustr.com:5602/goto/216fd46af0c2784f81fab4cbb965b89b" height="600" width="800"></iframe>	

<p>Applying the statistic over the whole list of players showed us some good news. There is value in the later rounds for Blocks, and Assists. These would be categories I would not be punting, because in order to compete in them, I didn't need to have a high draft pick. </p>

<p> Taking a further investigation into DD's, we can see that there is no real value in the later rounds in DD's. I would either need to invest heavily in the first few rounds, ensuring that I would be capable of winning the category, or I should not invest at all. 
At this stage, I'm going to punt DD's. </p> 

<h3> Strategy Time</h3>
<p>OK - time for some data exploration. What happens if I only determine a player value based on categories I want to win. So I'm going to remove double doubles, and the three point categories. Lets see what happens when I rerun the code, removing 3pp, 3pm, and DD's. </p>

<iframe src="https://kibana.fb8da90356c94a0bb4ebf52579e814bb.cu.dev.instaclustr.com:5602/goto/5c5aa5ecb55d95f50c8ac8a2849b86e0" height="600" width="800"></iframe>

<p>You can see we have changed up the top 10 quite abit, and if available, it shows who might be the best player for me to pickup. Giannis Antetokounmpo. He is ranked #10 overall normally, but #4 when I apply my punted categories. The other player I should look to try and grab with the #14 pick: Jimmy Butler. </p>

<p>Once we expand this to the top 150, we can start to see the "peaks” of players who are going to be great value in my strategy: Giannis, Jimmy Butler, Myles Turner, Blake Griffin, Demar Derozen, Nurkic, Clint Capela, Ben Simmons. Players in the later rounds, are just going to be the best players I can get. </p>

<h3 >(Realistic) Dream Team</h3>
<p>If I build my "Realistic Dream Team”, with players who are ranked around when I would be drafting, it would look a little something like this: </p>

<ul>
<li>#11 - Giannis Antetokounmpo(U)</li>
<li>#14 - Jimmy Butler (SG)</li>
<li># 35 - Myles Turner (PF)</li>
<li># 37 - Blake Griffin (F)</li>
<li># 56  - DeMar DeRozen (G)</li>
<li># 59 - Josip Nurkic (c)</li>
<li># 80 - Clint Capela (U)</li>
<li># 83 - Ben Simmons (PG)</li>
<li>#104 - Rajon Rondo (G)</li>
<li># 107 - Nerlens Noel (U)</li>
<li>#128 - Robin Lopez (B)</li>
<li># 131 - Josh Jackson (B) </li>
<li>#152 - Markelle Fultz (B) </li>
</ul>

<p>So how well would a team that looks like this perform? Lets have a look - Back to Kibana</p>

<iframe src="https://kibana.fb8da90356c94a0bb4ebf52579e814bb.cu.dev.instaclustr.com:5602/goto/dd44e98495c0c9cbcd64cb3a440c89b9" height="600" width="800"></iframe>

<p>As we can see, this team will perform quite well. Above "average" in 8 of the 11 categories, and well above average in 4.  The funny thing is, I was trying to punt DD's, which it says I will do better than average, and lose TO's, which i was trying to win. </p>

<h3> Quick Comparison of Players </h4>
<p>Now is the hard part. Mike Tyson once said "Everyone has a plan - until they get punched in the face". On draft day, I can almost guarantee i wont get my dream team. someone will take a player I wanted, or I will need to change my strategy, on the fly. With 90 seconds to decide which player to draft, I need a way to quickly compare multiple possible players, quickly, on draft day.</p>
<p>Say someone nabs a player I want a couple picks before I can. I need a way to compare a couple players according to my punting strategy. Or say I need to swap my punting strategy on the fly, I can again use kibana for this. </p>

<p> lets have a look at an example, say, for arguments sake I get the first 4 picks of my dream team. But DeMar DeRozen isn't there at #5. Who do I take? </p>

<p> Firstly, lets change the query to show my team's stats as currently constructed: </p>

<iframe src="https://kibana.fb8da90356c94a0bb4ebf52579e814bb.cu.dev.instaclustr.com:5602/goto/0ba59be406ae9baa5d3abe5873193bee" height="600" width="800"></iframe>

<p>Ok so no massive problems with any of the categories I am trying to win, lets say I've narrowed it down to Andrew Wiggins and Brook Lopez, and LaMarcus Aldridge. We can graph these two at a much more granular level </p>

<iframe src="https://kibana.fb8da90356c94a0bb4ebf52579e814bb.cu.dev.instaclustr.com:5602/goto/c62e5006b63dbf8bbfcde50c2ab4cbfb" height="600" width="800"></iframe>

<p> This graph shows me that Andrew wiggins is probably the best player to take, just because of his overall value. </p>

<h2> Analysis on standby</h2>
<p>So, with my dataset completed, and some queries ready to run come draft day, hopefully I will be in the best position to draft the best players available</p>
<p>So - What else do I need before draft day? Luck. A lot of good luck. </p>
